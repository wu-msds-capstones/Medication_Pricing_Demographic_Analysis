# Background and Data Collection

## Data sources

For data collection, our first focus was on collecting pricing information for different drugs tied to different geographic locations so we could easily pair those geographic locations with demographic census data. 

To obtain medication pricing data, we initially explored several APIs from online pharmacies, including GoodRx [@goodrx2025], which aim to improve consumer price transparency. However, these sources could not be reliably linked to the county-level demographic data essential to our analysis. Consequently, we turned to the Centers for Medicare & Medicaid Services (CMS), which offers one of the most comprehensive public datasets on healthcare coverage and drug pricing. CMS maintains over 100 datasets spanning prescription costs, plan structures, and beneficiary demographics [@cms2025data].

Among the available CMS datasets, we selected the Quarterly Prescription Drug Plan Formulary as our primary source. Of particular interest were the pricing files, basic formulary files, plan information files, and the geographic locator file, which enabled us to map drug prices and plan availability at the county level across the U.S. A key limitation of this dataset is that it reflects only those covered under Medicare, which applies to a specific segment of the population. Medicare eligibility generally requires individuals to be age 65 or older, although those with disabilities, end-stage renal disease (ESRD), or amyotrophic lateral sclerosis (ALS) may qualify earlier [@medicareEligibility]. Despite this limitation, Medicare formulary data, specifically Part D coverage, can serve as a functional proxy for medication prices across the US.  First, Medicare Part D covers over 50 million beneficiaries, which makes it one of the largest prescription drug programs in the US.  Medicare contracts with private insurers who then negotiate prices with drug manufacturers and pharmacies, which can reflect real-world pricing.  Medicare has tremendous leverage in the marketplace and is one of the largest purchasers of prescription drugs.  Accordingly, this makes Medicare a substantial market influencer, which means that its pricing can set or anchor prices for the entire marketplace.  We can reasonably infer that uninsured buyers, or buyers leveraging other forms of insurance, would pay at least as much as Medicare under Part D coverage.  

In conclusion, the formulary dataset offered a rare combination of granularity and breadth, with plan- and region-specific pricing that could be meaningfully paired with demographic data. It was also readily accessible and downloadable in bulk, making it a practical and robust foundation for our analysis.

The demographic data selection was much simpler, and we quickly concluded that the US Census [@uscensus2025] would provide county-level demographic information, which we could connect to the medication pricing data after only a little data cleaning. Our team leveraged the Tidycensus [@tidycensus2025] package in R to ingest demographic data at the county level.

During initial exploration, we found that the CMS datasets reference medications only by their National Drug Code (NDC), without corresponding drug names. To interpret these codes meaningfully, we integrated drug identification data from the FDA’s National Drug Code Directory [@fda2025ndc].
Finally, we incorporated three additional datasets from CMS to assess overall drug spending at the national level. These datasets, covering the years 2019 through 2023, provided high-level insights into Medicare and Medicaid expenditures, including spending under Medicare Part D, Medicare Part B, and Medicaid. While this data lacked the geographic granularity needed for county-level analysis, it offered valuable context by identifying medications with the greatest national impact based on total cost.
This broader perspective helped inform and prioritize our exploration of the formulary data. The national spending datasets included information on total spending, the number of beneficiaries, claims filed, and doses dispensed. This enabled us to assess patterns such as high-cost, low-frequency medications versus low-cost, high-frequency ones. Integrating this information into our broader database enhanced analytical flexibility and supported a more comprehensive understanding of pharmaceutical spending across programs.

## Data cleaning

Although the previous section may suggest that combining and storing the data was straightforward, the data cleaning and processing phase presented a significant challenge, consistent with the complexities typical of most data science projects.  Below, we outline several key issues encountered during this stage.

The CMS Quarterly Prescription Drug Plan Formulary datasets were significantly larger than those our team had previously worked with. Each quarterly file from 2019 Q1 through 2025 Q1 contained approximately 10–12 GB of compressed data. To manage scope, we narrowed our focus to the 2023 Q4 dataset. Even within this single quarter, the formulary included pricing data for approximately 6,336 unique medications (identified by NDC codes), across multiple dosage strengths and 30-, 60-, and 90-day supply options. These were distributed across 5,644 unique contract/plan combinations.
Some Medicare plan options were listed at the county level, while others were available only at the broader regional level, either as Medicare Advantage (MA, also known as Part C) or Prescription Drug Plans (PDP). To align these regional plans with our census-based demographic data, we disaggregated them by county. Medication prices varied not only by NDC code, but also by supply duration, dosage strength (e.g., 10 mg, 30 mg, 50 mg daily), delivery mechanism (e.g., pill, patch, injection, liquid), and Medicare plan.

A major limitation of the CMS formulary data was the absence of medication names; it included only 11-digit National Drug Code (NDC) identifiers. In contrast, the overall spending dataset listed drug names but did not include NDC codes, making it impossible to directly join the two datasets without an intermediary reference. Because NDC codes are not interpretable to non-experts, converting them to medication names was essential for meaningful analysis and presentation.

To resolve this, we turned to the FDA’s National Drug Code Directory [@fda2025ndc], which provides comprehensive drug identification data. However, we encountered a formatting mismatch: the NDC codes in the FDA dataset included dashes and excluded leading zeros, resulting in codes shorter than the 11-digit format used by CMS. The NDC structure consists of three segments (labeler (5 digits), product (4 digits), and package (2 digits)), but the FDA format often compresses these fields, creating inconsistencies once the dashes are removed.
To reconcile this, we standardized both datasets to a 9-digit format by removing the package-level detail and padding or trimming segments as needed. After extensive data cleaning and formatting, we successfully linked the FDA drug names to the CMS formulary data, enabling consistent identification and analysis across datasets.

Fortunately, the naming conventions utilized by CMS in their overall spending data were largely consistent with the naming conventions provided by the FDA (95% match), which allowed for the overall spending files to be related in the database to individual medication prices by county and Medicare plan.  The project now had compelling connections across a massive number of very large data files. 

During the geographic analysis, we identified a unique complication related to Connecticut. In 2022, all Connecticut counties were renamed and had their boundaries redrawn [@countiesConnecticut]. While our primary focus was on Q4 2023 data, a discrepancy emerged: CMS data continued to use the pre-2022 county names and boundaries, whereas the U.S. Census Bureau adopted the updated designations. Because the county shapes also changed, we applied engineering judgment to map the old county definitions to the new ones. As a result, any county-level analysis for Connecticut should be interpreted as an approximation. Data for all other U.S. counties remains accurate once spellings were matched.
